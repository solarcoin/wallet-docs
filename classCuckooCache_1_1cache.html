<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>SolarCoin: CuckooCache::cache&lt; Element, Hash &gt; Class Template Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SolarCoin
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespaceCuckooCache.html">CuckooCache</a></li><li class="navelem"><a class="el" href="classCuckooCache_1_1cache.html">cache</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classCuckooCache_1_1cache-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">CuckooCache::cache&lt; Element, Hash &gt; Class Template Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="cuckoocache_8h_source.html">cuckoocache.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:adcc64063187792eb7a1e21dd272f878a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCuckooCache_1_1cache.html#adcc64063187792eb7a1e21dd272f878a">cache</a> ()</td></tr>
<tr class="separator:adcc64063187792eb7a1e21dd272f878a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a49c60604e9dc27cbede5e54d56761778"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCuckooCache_1_1cache.html#a49c60604e9dc27cbede5e54d56761778">setup</a> (uint32_t new_size)</td></tr>
<tr class="separator:a49c60604e9dc27cbede5e54d56761778"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a835c482796c27ae4f3fd5d01173678a3"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCuckooCache_1_1cache.html#a835c482796c27ae4f3fd5d01173678a3">setup_bytes</a> (size_t bytes)</td></tr>
<tr class="separator:a835c482796c27ae4f3fd5d01173678a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7196070c52ba258b62a2c0d0bc7471d2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCuckooCache_1_1cache.html#a7196070c52ba258b62a2c0d0bc7471d2">insert</a> (Element e)</td></tr>
<tr class="separator:a7196070c52ba258b62a2c0d0bc7471d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a42efc693351a3e2426bbcb65bc871617"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a42efc693351a3e2426bbcb65bc871617"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><b>contains</b> (const Element &amp;e, const bool erase) const </td></tr>
<tr class="separator:a42efc693351a3e2426bbcb65bc871617"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><h3>template&lt;typename Element, typename Hash&gt;<br />
class CuckooCache::cache&lt; Element, Hash &gt;</h3>

<p>cache implements a cache with properties similar to a cuckoo-set</p>
<p>The cache is able to hold up to (~(uint32_t)0) - 1 elements.</p>
<p>Read Operations:</p><ul>
<li>contains(*, false)</li>
</ul>
<p>Read+Erase Operations:</p><ul>
<li>contains(*, true)</li>
</ul>
<p>Erase Operations:</p><ul>
<li>allow_erase()</li>
</ul>
<p>Write Operations:</p><ul>
<li><a class="el" href="classCuckooCache_1_1cache.html#a49c60604e9dc27cbede5e54d56761778">setup()</a></li>
<li><a class="el" href="classCuckooCache_1_1cache.html#a835c482796c27ae4f3fd5d01173678a3">setup_bytes()</a></li>
<li><a class="el" href="classCuckooCache_1_1cache.html#a7196070c52ba258b62a2c0d0bc7471d2">insert()</a></li>
<li>please_keep()</li>
</ul>
<p>Synchronization Free Operations:</p><ul>
<li>invalid()</li>
<li>compute_hashes()</li>
</ul>
<p>User Must Guarantee:</p>
<p>1) Write Requires synchronized access (e.g., a lock) 2) Read Requires no concurrent Write, synchronized with the last insert. 3) Erase requires no concurrent Write, synchronized with last insert. 4) An Erase caller must release all memory before allowing a new Writer.</p>
<p>Note on function names:</p><ul>
<li>The name "allow_erase" is used because the real discard happens later.</li>
<li>The name "please_keep" is used because elements may be erased anyways on insert.</li>
</ul>
<dl class="tparams"><dt>Template Parameters</dt><dd>
  <table class="tparams">
    <tr><td class="paramname">Element</td><td>should be a movable and copyable type </td></tr>
    <tr><td class="paramname">Hash</td><td>should be a function/callable which takes a template parameter hash_select and an Element and extracts a hash from it. Should return high-entropy hashes for <code>Hash h; h&lt;0&gt;(e) ... h&lt;7&gt;(e)</code>. </td></tr>
  </table>
  </dd>
</dl>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="adcc64063187792eb7a1e21dd272f878a"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Element , typename Hash &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classCuckooCache_1_1cache.html">CuckooCache::cache</a>&lt; Element, Hash &gt;::<a class="el" href="classCuckooCache_1_1cache.html">cache</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>You must always construct a cache with some elements via a subsequent call to setup or setup_bytes, otherwise operations may segfault. </p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a7196070c52ba258b62a2c0d0bc7471d2"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Element , typename Hash &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classCuckooCache_1_1cache.html">CuckooCache::cache</a>&lt; Element, Hash &gt;::insert </td>
          <td>(</td>
          <td class="paramtype">Element&#160;</td>
          <td class="paramname"><em>e</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>insert loops at most depth_limit times trying to insert a hash at various locations in the table via a variant of the Cuckoo Algorithm with eight hash locations.</p>
<p>It drops the last tried element if it runs out of depth before encountering an open slot.</p>
<p>Thus</p>
<p>insert(x); return contains(x, false);</p>
<p>is not guaranteed to return true.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">e</td><td>the element to insert </td></tr>
  </table>
  </dd>
</dl>
<dl class="section post"><dt>Postcondition</dt><dd>one of the following: All previously inserted elements and e are now in the table, one previously inserted element is evicted from the table, the entry attempted to be inserted is evicted. </dd></dl>
<p>Swap with the element at the location that was not the last one looked at. Example:</p>
<p>1) On first iteration, last_loc == invalid(), find returns last, so last_loc defaults to locs[0]. 2) On further iterations, where last_loc == locs[k], last_loc will go to locs[k+1 % 8], i.e., next of the 8 indices wrapping around to 0 if needed.</p>
<p>This prevents moving the element we just put in.</p>
<p>The swap is not a move &ndash; we must switch onto the evicted element for the next iteration.</p>

</div>
</div>
<a class="anchor" id="a49c60604e9dc27cbede5e54d56761778"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Element , typename Hash &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t <a class="el" href="classCuckooCache_1_1cache.html">CuckooCache::cache</a>&lt; Element, Hash &gt;::setup </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>new_size</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>setup initializes the container to store no more than new_size elements. setup rounds down to a power of two size.</p>
<p>setup should only be called once.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">new_size</td><td>the desired number of elements to store </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the maximum number of elements storable </dd></dl>

</div>
</div>
<a class="anchor" id="a835c482796c27ae4f3fd5d01173678a3"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Element , typename Hash &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t <a class="el" href="classCuckooCache_1_1cache.html">CuckooCache::cache</a>&lt; Element, Hash &gt;::setup_bytes </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>bytes</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>setup_bytes is a convenience function which accounts for internal memory usage when deciding how many elements to store. It isn't perfect because it doesn't account for any overhead (struct size, MallocUsage, collection and epoch flags). This was done to simplify selecting a power of two size. In the expected use case, an extra two bits per entry should be negligible compared to the size of the elements.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">bytes</td><td>the approximate number of bytes to use for this data structure. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the maximum number of elements storable (see <a class="el" href="classCuckooCache_1_1cache.html#a49c60604e9dc27cbede5e54d56761778">setup()</a> documentation for more detail) </dd></dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="cuckoocache_8h_source.html">cuckoocache.h</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
