<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>SolarCoin: kernel.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SolarCoin
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">kernel.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Kernel handling. Includes stake modifier, coin-age, stake-time and other PoST calculations.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;chain.h&gt;</code><br />
<code>#include &lt;chainparams.h&gt;</code><br />
<code>#include &lt;validation.h&gt;</code><br />
<code>#include &lt;boost/assign/list_of.hpp&gt;</code><br />
<code>#include &lt;rpc/server.h&gt;</code><br />
<code>#include &lt;txdb.h&gt;</code><br />
<code>#include &lt;timedata.h&gt;</code><br />
<code>#include &lt;kernel.h&gt;</code><br />
<code>#include &lt;pow.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for kernel.cpp:</div>
<div class="dyncontent">
<div class="center"><img src="kernel_8cpp__incl.png" border="0" usemap="#kernel_8cpp" alt=""/></div>
<map name="kernel_8cpp" id="kernel_8cpp">
<area shape="rect" id="node2" href="chain_8h_source.html" title="chain.h" alt="" coords="1127,229,1191,256"/>
<area shape="rect" id="node11" href="pow_8h_source.html" title="pow.h" alt="" coords="261,304,318,331"/>
<area shape="rect" id="node27" href="chainparams_8h_source.html" title="chainparams.h" alt="" coords="684,229,791,256"/>
<area shape="rect" id="node32" href="validation_8h_source.html" title="validation.h" alt="" coords="1292,80,1380,107"/>
<area shape="rect" id="node46" href="txdb_8h_source.html" title="txdb.h" alt="" coords="2132,155,2191,181"/>
<area shape="rect" id="node49" href="timedata_8h_source.html" title="timedata.h" alt="" coords="1760,453,1843,480"/>
<area shape="rect" id="node50" href="kernel_8h_source.html" title="kernel.h" alt="" coords="117,304,185,331"/>
<area shape="rect" id="node3" href="arith__uint256_8h_source.html" title="arith_uint256.h" alt="" coords="1179,453,1285,480"/>
<area shape="rect" id="node13" href="tinyformat_8h_source.html" title="tinyformat.h" alt="" coords="1064,453,1155,480"/>
<area shape="rect" id="node18" href="uint256_8h_source.html" title="uint256.h" alt="" coords="1309,453,1384,480"/>
<area shape="rect" id="node20" href="utilmoneystr_8h_source.html" title="utilmoneystr.h" alt="" coords="691,304,795,331"/>
<area shape="rect" id="node21" href="amount_8h_source.html" title="amount.h" alt="" coords="705,379,781,405"/>
<area shape="rect" id="node22" href="serialize_8h_source.html" title="serialize.h" alt="" coords="1867,453,1949,480"/>
<area shape="rect" id="node28" href="chainparamsbase_8h_source.html" title="chainparamsbase.h" alt="" coords="702,453,837,480"/>
<area shape="rect" id="node29" href="protocol_8h_source.html" title="protocol.h" alt="" coords="941,304,1019,331"/>
<area shape="rect" id="node30" href="netaddress_8h_source.html" title="netaddress.h" alt="" coords="963,379,1061,405"/>
<area shape="rect" id="node31" href="version_8h_source.html" title="version.h" alt="" coords="1611,453,1685,480"/>
<area shape="rect" id="node33" href="coins_8h_source.html" title="coins.h" alt="" coords="1584,229,1648,256"/>
<area shape="rect" id="node39" href="sync_8h_source.html" title="sync.h" alt="" coords="1660,155,1721,181"/>
<area shape="rect" id="node40" href="versionbits_8h_source.html" title="versionbits.h" alt="" coords="1177,155,1273,181"/>
<area shape="rect" id="node34" href="compressor_8h_source.html" title="compressor.h" alt="" coords="1849,379,1951,405"/>
<area shape="rect" id="node35" href="core__memusage_8h_source.html" title="core_memusage.h" alt="" coords="537,304,666,331"/>
<area shape="rect" id="node36" href="hash_8h_source.html" title="hash.h" alt="" coords="1612,379,1673,405"/>
<area shape="rect" id="node47" href="dbwrapper_8h_source.html" title="dbwrapper.h" alt="" coords="2115,229,2208,256"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:ad5fb0ec5b2523c87514c6638adc2d816"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ad5fb0ec5b2523c87514c6638adc2d816"></a>
typedef std::map&lt; int, unsigned int &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>MapModifierCheckpoints</b></td></tr>
<tr class="separator:ad5fb0ec5b2523c87514c6638adc2d816"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:abafb5fe836f10158e48d86a647c4c404"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="abafb5fe836f10158e48d86a647c4c404"></a>
int64_t&#160;</td><td class="memItemRight" valign="bottom"><b>GetWeight</b> (int64_t nIntervalBeginning, int64_t nIntervalEnd, const Consensus::Params &amp;params)</td></tr>
<tr class="separator:abafb5fe836f10158e48d86a647c4c404"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aabf3162e76735a40c2d7e4bf4e4e44e7"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kernel_8cpp.html#aabf3162e76735a40c2d7e4bf4e4e44e7">GetLastStakeModifier</a> (const <a class="el" href="classCBlockIndex.html">CBlockIndex</a> *pindex, uint64_t &amp;nStakeModifier, int64_t &amp;nModifierTime)</td></tr>
<tr class="separator:aabf3162e76735a40c2d7e4bf4e4e44e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a45403d13a291075ef95744e40f8d59f5"><td class="memItemLeft" align="right" valign="top">int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kernel_8cpp.html#a45403d13a291075ef95744e40f8d59f5">GetStakeModifierSelectionIntervalSection</a> (int nSection, const Consensus::Params &amp;params)</td></tr>
<tr class="separator:a45403d13a291075ef95744e40f8d59f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a70c80febd665515480d7d827780535b5"><td class="memItemLeft" align="right" valign="top">int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kernel_8cpp.html#a70c80febd665515480d7d827780535b5">GetStakeModifierSelectionInterval</a> (const Consensus::Params &amp;params)</td></tr>
<tr class="separator:a70c80febd665515480d7d827780535b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a85bb2a152c29e9042583212d5d4c49a9"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kernel_8cpp.html#a85bb2a152c29e9042583212d5d4c49a9">SelectBlockFromCandidates</a> (vector&lt; pair&lt; int64_t, <a class="el" href="classarith__uint256.html">arith_uint256</a> &gt; &gt; &amp;vSortedByTimestamp, map&lt; <a class="el" href="classuint256.html">uint256</a>, const <a class="el" href="classCBlockIndex.html">CBlockIndex</a> * &gt; &amp;mapSelectedBlocks, int64_t nSelectionIntervalStop, uint64_t nStakeModifierPrev, const <a class="el" href="classCBlockIndex.html">CBlockIndex</a> **pindexSelected, const Consensus::Params &amp;params)</td></tr>
<tr class="separator:a85bb2a152c29e9042583212d5d4c49a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a965d6a93d1545dbc6c05bfcbb3e7bd"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kernel_8cpp.html#a0a965d6a93d1545dbc6c05bfcbb3e7bd">ComputeNextStakeModifier</a> (const <a class="el" href="classCBlockIndex.html">CBlockIndex</a> *pindexCurrent, uint64_t &amp;nStakeModifier, bool &amp;fGeneratedStakeModifier, const Consensus::Params &amp;params)</td></tr>
<tr class="separator:a0a965d6a93d1545dbc6c05bfcbb3e7bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a376035e4620ab53052e3f83b04b60982"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kernel_8cpp.html#a376035e4620ab53052e3f83b04b60982">GetKernelStakeModifier</a> (<a class="el" href="classuint256.html">uint256</a> hashBlockFrom, uint64_t &amp;nStakeModifier, int &amp;nStakeModifierHeight, int64_t &amp;nStakeModifierTime, bool fPrintProofOfStake, const Consensus::Params &amp;params)</td></tr>
<tr class="memdesc:a376035e4620ab53052e3f83b04b60982"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the Kernel Stake Modifier object.  <a href="#a376035e4620ab53052e3f83b04b60982">More...</a><br /></td></tr>
<tr class="separator:a376035e4620ab53052e3f83b04b60982"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aafe543fad08cb98909952014752d4d0e"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kernel_8cpp.html#aafe543fad08cb98909952014752d4d0e">CheckStakeTimeKernelHash</a> (unsigned int nBits, const CBlock &amp;blockFrom, unsigned int nTxOffset, const CTransaction &amp;txPrev, const COutPoint &amp;prevout, unsigned int nTimeTx, <a class="el" href="classuint256.html">uint256</a> &amp;hashProofOfStake, <a class="el" href="classuint256.html">uint256</a> &amp;targetProofOfStake, <a class="el" href="classCBlockIndex.html">CBlockIndex</a> *pindexPrev, bool fPrintProofOfStake, const Consensus::Params &amp;params)</td></tr>
<tr class="memdesc:aafe543fad08cb98909952014752d4d0e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Validates whether a given hashProofOfStake meets the target.  <a href="#aafe543fad08cb98909952014752d4d0e">More...</a><br /></td></tr>
<tr class="separator:aafe543fad08cb98909952014752d4d0e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeed5f9fe3f744660b34346d64b415d6e"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kernel_8cpp.html#aeed5f9fe3f744660b34346d64b415d6e">CheckProofOfStake</a> (const CTransaction &amp;tx, unsigned int nBits, <a class="el" href="classuint256.html">uint256</a> &amp;hashProofOfStake, <a class="el" href="classuint256.html">uint256</a> &amp;targetProofOfStake, const Consensus::Params &amp;params)</td></tr>
<tr class="memdesc:aeed5f9fe3f744660b34346d64b415d6e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check kernel hash target and coinstake signature.  <a href="#aeed5f9fe3f744660b34346d64b415d6e">More...</a><br /></td></tr>
<tr class="separator:aeed5f9fe3f744660b34346d64b415d6e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a99ed8dbe3ebe13be7f5d4108e1fdcfa0"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kernel_8cpp.html#a99ed8dbe3ebe13be7f5d4108e1fdcfa0">CheckCoinStakeTimestamp</a> (int64_t nTimeBlock, int64_t nTimeTx)</td></tr>
<tr class="memdesc:a99ed8dbe3ebe13be7f5d4108e1fdcfa0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check whether the coinstake timestamp meets protocol. Does not appear to be currently used.  <a href="#a99ed8dbe3ebe13be7f5d4108e1fdcfa0">More...</a><br /></td></tr>
<tr class="separator:a99ed8dbe3ebe13be7f5d4108e1fdcfa0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a660b64df00145bd8eb1ad48b0954a8fd"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kernel_8cpp.html#a660b64df00145bd8eb1ad48b0954a8fd">GetStakeModifierChecksum</a> (const <a class="el" href="classCBlockIndex.html">CBlockIndex</a> *pindex, const Consensus::Params &amp;params)</td></tr>
<tr class="memdesc:a660b64df00145bd8eb1ad48b0954a8fd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Build the stake modifier checksum for a block.  <a href="#a660b64df00145bd8eb1ad48b0954a8fd">More...</a><br /></td></tr>
<tr class="separator:a660b64df00145bd8eb1ad48b0954a8fd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ace6da0cc4405eedd50d7a15d9f3e4f74"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kernel_8cpp.html#ace6da0cc4405eedd50d7a15d9f3e4f74">CheckStakeModifierCheckpoints</a> (int nHeight, unsigned int nStakeModifierChecksum)</td></tr>
<tr class="memdesc:ace6da0cc4405eedd50d7a15d9f3e4f74"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check stake modifier hard checkpoints.  <a href="#ace6da0cc4405eedd50d7a15d9f3e4f74">More...</a><br /></td></tr>
<tr class="separator:ace6da0cc4405eedd50d7a15d9f3e4f74"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7b8ba185b3c3233529a05a33645c4eeb"><td class="memItemLeft" align="right" valign="top">int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kernel_8cpp.html#a7b8ba185b3c3233529a05a33645c4eeb">GetStakeTimeFactoredWeight</a> (int64_t timeWeight, int64_t nCoinDayWeight, <a class="el" href="classCBlockIndex.html">CBlockIndex</a> *pindexPrev, const Consensus::Params &amp;params)</td></tr>
<tr class="memdesc:a7b8ba185b3c3233529a05a33645c4eeb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the Stake Time Factored Weight (consensus power) for both reward and PoST hashing.  <a href="#a7b8ba185b3c3233529a05a33645c4eeb">More...</a><br /></td></tr>
<tr class="separator:a7b8ba185b3c3233529a05a33645c4eeb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a972ed0f725b9f97763fb603367e79f3b"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kernel_8cpp.html#a972ed0f725b9f97763fb603367e79f3b">GetAverageStakeWeight</a> (<a class="el" href="classCBlockIndex.html">CBlockIndex</a> *pindexPrev, const Consensus::Params &amp;params)</td></tr>
<tr class="memdesc:a972ed0f725b9f97763fb603367e79f3b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the Average Stake Weight of the network over the past 60 blocks for PoST hash and stake calculations.  <a href="#a972ed0f725b9f97763fb603367e79f3b">More...</a><br /></td></tr>
<tr class="separator:a972ed0f725b9f97763fb603367e79f3b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a17d4fda76a2585ff2338ead8181f5954"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kernel_8cpp.html#a17d4fda76a2585ff2338ead8181f5954">GetCoinAge</a> (const CTransaction &amp;tx, uint64_t &amp;nCoinAge, const Consensus::Params &amp;params)</td></tr>
<tr class="memdesc:a17d4fda76a2585ff2338ead8181f5954"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the Coin Age of a transaction.  <a href="#a17d4fda76a2585ff2338ead8181f5954">More...</a><br /></td></tr>
<tr class="separator:a17d4fda76a2585ff2338ead8181f5954"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a713b00927deba2f898c7e9118922f01f"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kernel_8cpp.html#a713b00927deba2f898c7e9118922f01f">GetStakeTime</a> (const CTransaction &amp;tx, uint64_t &amp;nStakeTime, <a class="el" href="classCBlockIndex.html">CBlockIndex</a> *pindexPrev, const Consensus::Params &amp;params)</td></tr>
<tr class="memdesc:a713b00927deba2f898c7e9118922f01f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the Stake Time for a transaction for PoST.  <a href="#a713b00927deba2f898c7e9118922f01f">More...</a><br /></td></tr>
<tr class="separator:a713b00927deba2f898c7e9118922f01f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a651f5c971eaf577484d0df944ae1d8c6"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kernel_8cpp.html#a651f5c971eaf577484d0df944ae1d8c6">GetPoSKernelPS</a> (<a class="el" href="classCBlockIndex.html">CBlockIndex</a> *pindexPrev, const Consensus::Params &amp;params)</td></tr>
<tr class="memdesc:a651f5c971eaf577484d0df944ae1d8c6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the stake weight for an interval of prior blocks (?)  <a href="#a651f5c971eaf577484d0df944ae1d8c6">More...</a><br /></td></tr>
<tr class="separator:a651f5c971eaf577484d0df944ae1d8c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a79d1d2a45b378965a3e98d9ad04c1aba"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a79d1d2a45b378965a3e98d9ad04c1aba"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>nAverageStakeWeightHeightCached</b> = 0</td></tr>
<tr class="separator:a79d1d2a45b378965a3e98d9ad04c1aba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a44751cd3b897e2a4c2285c84c2de9420"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a44751cd3b897e2a4c2285c84c2de9420"></a>
double&#160;</td><td class="memItemRight" valign="bottom"><b>dAverageStakeWeightCached</b> = 0</td></tr>
<tr class="separator:a44751cd3b897e2a4c2285c84c2de9420"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae758ae3a16032f4211389298c75de9e2"><td class="memItemLeft" align="right" valign="top">static std::map&lt; int, unsigned int &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>mapStakeModifierCheckpoints</b></td></tr>
<tr class="separator:ae758ae3a16032f4211389298c75de9e2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5247c46a05f71a8635d71cf294d6b88e"><td class="memItemLeft" align="right" valign="top">static std::map&lt; int, unsigned int &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>mapStakeModifierCheckpointsTestNet</b></td></tr>
<tr class="separator:a5247c46a05f71a8635d71cf294d6b88e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Kernel handling. Includes stake modifier, coin-age, stake-time and other PoST calculations. </p>
<p>Stake Modifier (hash modifier of proof-of-stake): The purpose of the stake modifier is to prevent a given txout (coin) owner from computing future proof-of-stake generated by the txout as soon as the transaction is confirmed of transaction confirmation. To meet kernel protocol, the txout must hash with a future stake modifier to generate the proof.</p>
<p>The stake modifier consists of several bits, each of which is contributed from a selected block from a of a given block group in the past. The selection of a block is based on a hash of the block's proof-hash and the previous stake modifier.</p>
<p>The stake modifier is recomputed at a fixed time interval instead of every block. This is to make it difficult for an attacker to gain control of additional bits in the stake modifier, even after generating a chain of blocks. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a99ed8dbe3ebe13be7f5d4108e1fdcfa0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool CheckCoinStakeTimestamp </td>
          <td>(</td>
          <td class="paramtype">int64_t&#160;</td>
          <td class="paramname"><em>nTimeBlock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t&#160;</td>
          <td class="paramname"><em>nTimeTx</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check whether the coinstake timestamp meets protocol. Does not appear to be currently used. </p>
<p>Returns true if nTimeBlock == nTimeTx</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">nTimeBlock</td><td></td></tr>
    <tr><td class="paramname">nTimeTx</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true </dd>
<dd>
false </dd></dl>

</div>
</div>
<a class="anchor" id="aeed5f9fe3f744660b34346d64b415d6e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool CheckProofOfStake </td>
          <td>(</td>
          <td class="paramtype">const CTransaction &amp;&#160;</td>
          <td class="paramname"><em>tx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>nBits</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classuint256.html">uint256</a> &amp;&#160;</td>
          <td class="paramname"><em>hashProofOfStake</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classuint256.html">uint256</a> &amp;&#160;</td>
          <td class="paramname"><em>targetProofOfStake</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Consensus::Params &amp;&#160;</td>
          <td class="paramname"><em>params</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check kernel hash target and coinstake signature. </p>
<p>Called from <a class="el" href="validation_8cpp.html#a290fce59049c0951b8eb73f0129bf6f0">ProcessNewBlock()</a>.</p>
<p>Uses the transaction stored at the block-to-be-validated's vtx[1]. (the first non-coinstake tx?). That transaction's vin[0].prevout.hash (the tx hash of the previous output of the first input of the new block's first non-coinstake tx) is fetched from the database, along with the hash of its corresponding block. That prior block and tx, along with the tx's offset inside the block, are used to generate the proof-of-stake for the new block.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">tx</td><td>Corresponds to the new block's vtx[1]. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">nBits</td><td>The nBits of the new block </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">hashProofOfStake</td><td>address to store the new block's hashProofOfStake </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">targetProofOfStake</td><td>address to store the new block's targetProofOfStake </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">params</td><td>Consensus parameters </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true </dd>
<dd>
false </dd></dl>

</div>
</div>
<a class="anchor" id="ace6da0cc4405eedd50d7a15d9f3e4f74"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool CheckStakeModifierCheckpoints </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nHeight</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>nStakeModifierChecksum</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check stake modifier hard checkpoints. </p>
<p>Called from AddToBlockIndex() and LoadBlockIndexDB()</p>
<p>Checks to see if a given block's height is in the checkpoint map, then if so compares the block's stake modifier checksum with the checkpoint map's stake modifier checksum</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">nHeight</td><td>A block height </td></tr>
    <tr><td class="paramname">nStakeModifierChecksum</td><td>A stake modifier checksum </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true </dd>
<dd>
false </dd></dl>

</div>
</div>
<a class="anchor" id="aafe543fad08cb98909952014752d4d0e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool CheckStakeTimeKernelHash </td>
          <td>(</td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>nBits</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const CBlock &amp;&#160;</td>
          <td class="paramname"><em>blockFrom</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>nTxOffset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const CTransaction &amp;&#160;</td>
          <td class="paramname"><em>txPrev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const COutPoint &amp;&#160;</td>
          <td class="paramname"><em>prevout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>nTimeTx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classuint256.html">uint256</a> &amp;&#160;</td>
          <td class="paramname"><em>hashProofOfStake</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classuint256.html">uint256</a> &amp;&#160;</td>
          <td class="paramname"><em>targetProofOfStake</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classCBlockIndex.html">CBlockIndex</a> *&#160;</td>
          <td class="paramname"><em>pindexPrev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>fPrintProofOfStake</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Consensus::Params &amp;&#160;</td>
          <td class="paramname"><em>params</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Validates whether a given hashProofOfStake meets the target. </p>
<p>Called from <a class="el" href="kernel_8cpp.html#aeed5f9fe3f744660b34346d64b415d6e" title="Check kernel hash target and coinstake signature. ">CheckProofOfStake()</a>.</p>
<p>Calculates the targetProofOfStake based on the given stake's stake-time factored weight (via <a class="el" href="kernel_8cpp.html#a7b8ba185b3c3233529a05a33645c4eeb" title="Get the Stake Time Factored Weight (consensus power) for both reward and PoST hashing. ">GetStakeTimeFactoredWeight()</a>).</p>
<p>Builds the stake's hash, modified by the stake modifier (via <a class="el" href="kernel_8cpp.html#a376035e4620ab53052e3f83b04b60982" title="Get the Kernel Stake Modifier object. ">GetKernelStakeModifier()</a>), then compares to the target. If the stake's hash &lt; target, return true.</p>
<p>SolarCoin kernel protocol PoST coinstake must meet hash target according to the protocol: kernel (input 0) must meet the formula hash(nStakeModifier + txPrev.block.nTime + txPrev.offset + txPrev.nTime + txPrev.vout.n + nTime) &lt; bnTarget * nStakeTimeWeight this ensures that the chance of getting a coinstake is proportional to the amount of coin age owned, time factored by the current network strength. The reason this hash is chosen is the following: nStakeModifier: scrambles computation to make it very difficult to precompute future proof-of-stake at the time of the coin's confirmation txPrev.block.nTime: prevent nodes from guessing a good timestamp to generate transaction for future advantage txPrev.offset: offset of txPrev inside block, to reduce the chance of nodes generating coinstake at the same time txPrev.nTime: reduce the chance of nodes generating coinstake at the same time txPrev.vout.n: output number of txPrev, to reduce the chance of nodes generating coinstake at the same time block/tx hash should not be used here as they can be generated in vast quantities so as to generate blocks faster, degrading the system back into a proof-of-work situation.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">nBits</td><td>The new block's nBits </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">blockFrom</td><td>The block being used to generate the stake hash </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">nTxOffset</td><td>The byte-level offset of the transaction inside the block. Seems to depend on the txIndex being built </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">txPrev</td><td>The transaction used to find the block used to generate the stake hash </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">prevout</td><td>The previous output of the first input of the new block's (not the block used to generate the stake hash) first non-coinstake tx (vtx[1]) </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">nTimeTx</td><td>The timestamp of the new block's first non-coinstake tx (vtx[1]) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">hashProofOfStake</td><td>An address to hold the hashProofOfStake </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">targetProofOfStake</td><td>An address to hold the targetProofOfStake </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">pindexPrev</td><td>Pointer to (which block?): chainActive.Tip()-&gt;pprev </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">fPrintProofOfStake</td><td>A flag for additional debug logging, equal to fDebug </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">params</td><td>Consensus params </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true </dd>
<dd>
false </dd></dl>

</div>
</div>
<a class="anchor" id="a0a965d6a93d1545dbc6c05bfcbb3e7bd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ComputeNextStakeModifier </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classCBlockIndex.html">CBlockIndex</a> *&#160;</td>
          <td class="paramname"><em>pindexCurrent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t &amp;&#160;</td>
          <td class="paramname"><em>nStakeModifier</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &amp;&#160;</td>
          <td class="paramname"><em>fGeneratedStakeModifier</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Consensus::Params &amp;&#160;</td>
          <td class="paramname"><em>params</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Called from AddToBlockIndex().</p>
<p>Generates a new stake modifier. Retrieves the existing stake modifier for use in the new hash computation, specifies a time interval, then walks back in the chain to collect the blocks in the time interval into a vector. Over vector.size() rounds, blocks are selected (reordered?), then the entropy bit of each is written to generate the new stake modifier. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">vSortedByTimestmp</td><td>pindexCurrent a pointer to the most recent block </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">nStakeModifier</td><td>the newly generated stake modifier </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">fGeneratedstakeModifier</td><td>a flag indicating whether or not the new modifier has been created </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">params</td><td>Consensus params </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a972ed0f725b9f97763fb603367e79f3b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double GetAverageStakeWeight </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classCBlockIndex.html">CBlockIndex</a> *&#160;</td>
          <td class="paramname"><em>pindexPrev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Consensus::Params &amp;&#160;</td>
          <td class="paramname"><em>params</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the Average Stake Weight of the network over the past 60 blocks for PoST hash and stake calculations. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pindexPrev</td><td>pointer to the previous block </td></tr>
    <tr><td class="paramname">params</td><td>consensus params </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>double </dd></dl>

</div>
</div>
<a class="anchor" id="a17d4fda76a2585ff2338ead8181f5954"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool GetCoinAge </td>
          <td>(</td>
          <td class="paramtype">const CTransaction &amp;&#160;</td>
          <td class="paramname"><em>tx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t &amp;&#160;</td>
          <td class="paramname"><em>nCoinAge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Consensus::Params &amp;&#160;</td>
          <td class="paramname"><em>params</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the Coin Age of a transaction. </p>
<p>Never called(?)</p>
<p>Total coin age spent in transaction, in the unit of coin-days. Only those coins meeting minimum age requirement counts. As those transactions not in main chain are not currently indexed so we might not find out about their coin age. Older transactions are guaranteed to be in main chain by sync-checkpoint. This rule is introduced to help nodes establish a consistent view of the coin age (trust score) of competing branches.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">tx</td><td>transaction to get the coin-age for </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">nCoinAge</td><td>address to store the coinAge in </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">params</td><td>consensus params </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true </dd>
<dd>
false </dd></dl>

</div>
</div>
<a class="anchor" id="a376035e4620ab53052e3f83b04b60982"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool GetKernelStakeModifier </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classuint256.html">uint256</a>&#160;</td>
          <td class="paramname"><em>hashBlockFrom</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t &amp;&#160;</td>
          <td class="paramname"><em>nStakeModifier</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int &amp;&#160;</td>
          <td class="paramname"><em>nStakeModifierHeight</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t &amp;&#160;</td>
          <td class="paramname"><em>nStakeModifierTime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>fPrintProofOfStake</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Consensus::Params &amp;&#160;</td>
          <td class="paramname"><em>params</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get the Kernel Stake Modifier object. </p>
<p>Called from <a class="el" href="kernel_8cpp.html#aafe543fad08cb98909952014752d4d0e" title="Validates whether a given hashProofOfStake meets the target. ">CheckStakeTimeKernelHash()</a>. Fetches the kernel stake modifier for a given block.</p>
<p>The stake modifier used to hash for a stake kernel is chosen as the stake modifier about a selection interval later than the coin generating the kernel</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">hashBlockFrom</td><td>the block to fetch the stake modifier for </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">nStakeModifier</td><td>the address to store the stake modifier </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">nStakeModifierHeight</td><td>the address to store the height of the block with the hash specified in hashBlockFrom </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">nStakeModifierTime</td><td>the address to store the timestamp of the block with the hash specified in hashBlockFrom </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">fPrintProofOfStake</td><td>a flag for extended debug print information </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">params</td><td>consensus parameters </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true </dd>
<dd>
false </dd></dl>

</div>
</div>
<a class="anchor" id="aabf3162e76735a40c2d7e4bf4e4e44e7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool GetLastStakeModifier </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classCBlockIndex.html">CBlockIndex</a> *&#160;</td>
          <td class="paramname"><em>pindex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t &amp;&#160;</td>
          <td class="paramname"><em>nStakeModifier</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t &amp;&#160;</td>
          <td class="paramname"><em>nModifierTime</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Gets the last stake modifier and its generation time from a given block and stores them in the nStakeModifier and nModifierTime params. Iterates through prior block pointers until a stake modifier is found. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">pindex</td><td>a pointer to a block </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">nStakeModifier</td><td>an address to hold the most recent stake modifier from the given block </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">nModifierTime</td><td>an address to hold the blocktime where the stake modifier was found </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a651f5c971eaf577484d0df944ae1d8c6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double GetPoSKernelPS </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classCBlockIndex.html">CBlockIndex</a> *&#160;</td>
          <td class="paramname"><em>pindexPrev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Consensus::Params &amp;&#160;</td>
          <td class="paramname"><em>params</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the stake weight for an interval of prior blocks (?) </p>
<p>Called from <a class="el" href="kernel_8cpp.html#a972ed0f725b9f97763fb603367e79f3b" title="Get the Average Stake Weight of the network over the past 60 blocks for PoST hash and stake calculati...">GetAverageStakeWeight()</a></p>
<p>Returns the sum of difficulty of a series of blocks over an interval divided by the total time taken between blocks in the interval</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pindexPrev</td><td>pointer to prior block </td></tr>
    <tr><td class="paramname">params</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>double </dd></dl>

</div>
</div>
<a class="anchor" id="a660b64df00145bd8eb1ad48b0954a8fd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int GetStakeModifierChecksum </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classCBlockIndex.html">CBlockIndex</a> *&#160;</td>
          <td class="paramname"><em>pindex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Consensus::Params &amp;&#160;</td>
          <td class="paramname"><em>params</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Build the stake modifier checksum for a block. </p>
<p>Called from AddToBlockIndex().</p>
<p>Hashes the previous block's stake modifier checksum with the new block's nFlags (?) and hashProofOfStake</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pindex</td><td>A pointer to the new block index entry </td></tr>
    <tr><td class="paramname">params</td><td>Consensus parameters </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>unsigned int </dd></dl>

</div>
</div>
<a class="anchor" id="a70c80febd665515480d7d827780535b5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t GetStakeModifierSelectionInterval </td>
          <td>(</td>
          <td class="paramtype">const Consensus::Params &amp;&#160;</td>
          <td class="paramname"><em>params</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Gets the selection interval (in seconds) </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">nSection</td><td>a the current interval section </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">params</td><td>consensus parameters </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a45403d13a291075ef95744e40f8d59f5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t GetStakeModifierSelectionIntervalSection </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nSection</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Consensus::Params &amp;&#160;</td>
          <td class="paramname"><em>params</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Gets the selection interval section (in seconds) </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">nSection</td><td>a the current interval section </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">params</td><td>consensus parameters </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a713b00927deba2f898c7e9118922f01f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool GetStakeTime </td>
          <td>(</td>
          <td class="paramtype">const CTransaction &amp;&#160;</td>
          <td class="paramname"><em>tx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t &amp;&#160;</td>
          <td class="paramname"><em>nStakeTime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classCBlockIndex.html">CBlockIndex</a> *&#160;</td>
          <td class="paramname"><em>pindexPrev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Consensus::Params &amp;&#160;</td>
          <td class="paramname"><em>params</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the Stake Time for a transaction for PoST. </p>
<p>Called from <a class="el" href="validation_8cpp.html#a5275e47f374a9a1f53e8f95da0bfee87">ConnectBlock()</a></p>
<p>SolarCoin: total stake time spent in transaction that is accepted by the network, in the unit of coin-days. Only those coins meeting minimum age requirement counts. As those transactions not in main chain are not currently indexed so we might not find out about their coin age. Older transactions are guaranteed to be in main chain by sync-checkpoint. This rule is introduced to help nodes establish a consistent view of the coin age (trust score) of competing branches.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tx</td><td>transaction to get the coin-age for </td></tr>
    <tr><td class="paramname">nStakeTime</td><td>address to store the coinAge in </td></tr>
    <tr><td class="paramname">pindexPrev</td><td>pointer to previous block </td></tr>
    <tr><td class="paramname">params</td><td>consensus params </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true </dd>
<dd>
false </dd></dl>

</div>
</div>
<a class="anchor" id="a7b8ba185b3c3233529a05a33645c4eeb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t GetStakeTimeFactoredWeight </td>
          <td>(</td>
          <td class="paramtype">int64_t&#160;</td>
          <td class="paramname"><em>timeWeight</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t&#160;</td>
          <td class="paramname"><em>nCoinDayWeight</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classCBlockIndex.html">CBlockIndex</a> *&#160;</td>
          <td class="paramname"><em>pindexPrev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Consensus::Params &amp;&#160;</td>
          <td class="paramname"><em>params</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the Stake Time Factored Weight (consensus power) for both reward and PoST hashing. </p>
<p>Called from <a class="el" href="kernel_8cpp.html#a713b00927deba2f898c7e9118922f01f" title="Get the Stake Time for a transaction for PoST. ">GetStakeTime()</a> and <a class="el" href="kernel_8cpp.html#aafe543fad08cb98909952014752d4d0e" title="Validates whether a given hashProofOfStake meets the target. ">CheckStakeTimeKernelHash()</a></p>
<p>As described in the whitepaper at <a href="https://www.vericoin.info/downloads/VeriCoinPoSTWhitePaper10May2015.pdf,">https://www.vericoin.info/downloads/VeriCoinPoSTWhitePaper10May2015.pdf,</a> the Stake-Time is a modified coin-age for a given UTXO.</p>
<p>This fraction is the ratio of the coin-age to the network-wide stake-time weight over the last 60 blocks. It is then further modified, reducing the weight of large stakes and evening out consensus, using the formula fraction of consensus power = Cosine(consensus power * pi) ^ 2, with an upper bound on consensus power to prevent large wallet attacks.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">timeWeight</td><td>difference in timestamps between the stake tx and the previous tx </td></tr>
    <tr><td class="paramname">nCoinDayWeight</td><td>coin-age of a tx </td></tr>
    <tr><td class="paramname">pindexPrev</td><td>pointer to previous block </td></tr>
    <tr><td class="paramname">params</td><td>consensus params </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int64_t </dd></dl>

</div>
</div>
<a class="anchor" id="a85bb2a152c29e9042583212d5d4c49a9"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool SelectBlockFromCandidates </td>
          <td>(</td>
          <td class="paramtype">vector&lt; pair&lt; int64_t, <a class="el" href="classarith__uint256.html">arith_uint256</a> &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>vSortedByTimestamp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">map&lt; <a class="el" href="classuint256.html">uint256</a>, const <a class="el" href="classCBlockIndex.html">CBlockIndex</a> * &gt; &amp;&#160;</td>
          <td class="paramname"><em>mapSelectedBlocks</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t&#160;</td>
          <td class="paramname"><em>nSelectionIntervalStop</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>nStakeModifierPrev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classCBlockIndex.html">CBlockIndex</a> **&#160;</td>
          <td class="paramname"><em>pindexSelected</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Consensus::Params &amp;&#160;</td>
          <td class="paramname"><em>params</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Called from <a class="el" href="kernel_8cpp.html#a0a965d6a93d1545dbc6c05bfcbb3e7bd">ComputeNextStakeModifier()</a>.</p>
<p>Iterates over the candidate blocks in vSortedByTimestamp, computing the selection hash from the proofhash and previous stake modifier, and selecting the lowest one. Excludes blocks already in vSelectedBlocks, breaks when the timestamp of a block in the sorted vector is greater than the interval stop. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">vSortedByTimestmp</td><td>a vector of block hashes and timestamps </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">mapSelectedBlocks</td><td>a map of blocks chosen for this interval (?) </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">nSelectionIntervalStop</td><td>the endpoint timestamp for the interval </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">nStakeModifierPrev</td><td>the existing stake modifier, prior to this one being computed </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">pindexSelected[out]</td><td>the pointer to the selected block from the candidates </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="ae758ae3a16032f4211389298c75de9e2"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt;int, unsigned int&gt; mapStakeModifierCheckpoints</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">=</div><div class="line">    boost::assign::map_list_of</div><div class="line">        ( 0, 0x0fd11f4e7 )</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5247c46a05f71a8635d71cf294d6b88e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt;int, unsigned int&gt; mapStakeModifierCheckpointsTestNet</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">=</div><div class="line">    boost::assign::map_list_of</div><div class="line">        ( 0, 0)</div></div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
